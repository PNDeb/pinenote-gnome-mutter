From: Carlos Garnacho <carlosg@gnome.org>
Date: Tue, 28 Feb 2023 17:30:08 +0100
Subject: Revert "x11: Do not move X11 input focus during grabs"

This reverts commit a68b8e95954772cd6f5d676a803e01c13e48c83f.

Part-of: <https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/2878>
Origin: upstream, 44.rc, commit:7de834b915a0361a298d790b8d337e170cb2b99d
---
 src/core/events.c                  |  4 ----
 src/x11/meta-x11-display-private.h |  2 --
 src/x11/meta-x11-display.c         | 20 --------------------
 3 files changed, 26 deletions(-)

diff --git a/src/core/events.c b/src/core/events.c
index f6477b7..aaf6f49 100644
--- a/src/core/events.c
+++ b/src/core/events.c
@@ -34,7 +34,6 @@
 #include "core/display-private.h"
 #include "core/window-private.h"
 #include "meta/meta-backend.h"
-#include "x11/meta-x11-display-private.h"
 
 #ifdef HAVE_NATIVE_BACKEND
 #include "backends/native/meta-backend-native.h"
@@ -261,9 +260,6 @@ meta_display_handle_event (MetaDisplay        *display,
           display->grabbed_in_clutter = FALSE;
           meta_compositor_grab_end (compositor);
         }
-
-      if (display->x11_display)
-        meta_x11_display_sync_input_focus (display->x11_display);
     }
 
   device = clutter_event_get_device (event);
diff --git a/src/x11/meta-x11-display-private.h b/src/x11/meta-x11-display-private.h
index d8be49e..a811131 100644
--- a/src/x11/meta-x11-display-private.h
+++ b/src/x11/meta-x11-display-private.h
@@ -258,8 +258,6 @@ void meta_x11_display_set_input_focus (MetaX11Display *x11_display,
                                        gboolean        focus_frame,
                                        uint32_t        timestamp);
 
-void meta_x11_display_sync_input_focus (MetaX11Display *x11_display);
-
 MetaDisplay * meta_x11_display_get_display (MetaX11Display *x11_display);
 
 #endif /* META_X11_DISPLAY_PRIVATE_H */
diff --git a/src/x11/meta-x11-display.c b/src/x11/meta-x11-display.c
index 09cd332..729d8c0 100644
--- a/src/x11/meta-x11-display.c
+++ b/src/x11/meta-x11-display.c
@@ -1944,10 +1944,6 @@ meta_x11_display_set_input_focus_internal (MetaX11Display *x11_display,
                                            Window          xwindow,
                                            uint32_t        timestamp)
 {
-  if (xwindow != None &&
-      !meta_display_windows_are_interactable (x11_display->display))
-    return;
-
   meta_x11_error_trap_push (x11_display);
 
   /* In order for mutter to know that the focus request succeeded, we track
@@ -2020,22 +2016,6 @@ meta_x11_display_set_input_focus_xwindow (MetaX11Display *x11_display,
   x11_display->display->last_focus_time = timestamp;
 }
 
-void
-meta_x11_display_sync_input_focus (MetaX11Display *x11_display)
-{
-  guint timestamp;
-
-  if (!meta_display_windows_are_interactable (x11_display->display))
-    return;
-
-  meta_x11_error_trap_push (x11_display);
-  timestamp = meta_display_get_current_time (x11_display->display);
-  meta_x11_display_set_input_focus_internal (x11_display,
-                                             x11_display->focus_xwindow,
-                                             timestamp);
-  meta_x11_error_trap_pop (x11_display);
-}
-
 static MetaX11DisplayLogicalMonitorData *
 get_x11_display_logical_monitor_data (MetaLogicalMonitor *logical_monitor)
 {
